# Глава 17 - Поиск переменного серийного номера. Часть 2

## Крэкми CrueHead’а

Хорошо, прежде всего мы решим крэкми MEXCRK1.ZIP ***\[[ссылка](files/16/mexcrk1.7z)\]***. Он очень лёгкий. Откроем его в OllyDbg и окажемся в точке входа.

![](img/17/1.png)

Смотрим строки, которые используются программой. Нажимаем правую кнопку мыши.

![](img/17/2.png)

Видим среди строк следующие:

![](img/17/3.png)

Можем кликнуть на той, которая сообщает об успехе, или сообщающей о неудаче, чтобы попасть в интересующую нас область программы.

![](img/17/4.png)

Видим, что здесь есть call, после которого управление передаётся на код либо с «WRONG CODE DUDE», либо c «THANKS YOU MADE IT».

Устанавливаем BPX на CALL в 42d534 и нажимаем RUN.

![](img/17/5.png)

Введём неправильный серийный номер в поле, которое называется «Enter Serial #».

![](img/17/6.png)

В моём случае печатаем Narvajita.

![](img/17/7.png)

Если войдём в режиме трассировки в CALL, то увидим, что сравнивается введённый серийник «Narvajita» со строкой «Benadryl».

![](img/17/8.png)

![](img/17/9.png)

Ок, теперь мы оказываемся рядом со сравнением, так что правильным серийным номером является слово «Benadryl». Сделаем RUN по-новой, убрав предварительно все BPX.

![](img/17/10.png)

Здесь видим, что нас поздравляют с нахождением правильного серийного номера .

## Игра Canasta v5.0

Ок, теперь разберём последний случай подобного типа, а со следующей главы начнём новую тему. Это небольшая программка, являющееся игрой под названием canasta 5.0 ***\[[ссылка](files/17/cansetup.7z)\]***.

Эта программа относится к той категории, где кнопка OK в начале недоступна для нажатия, но когда пользователь заканчивает вводить свои данные, то если они верны, на неё становится возможным нажать.

Установим программу и зайдём в About.

![](img/17/11.png)

Она стоит, друзья, 20 долларов, вернее 19.95.

![](img/17/12.png)

Видим кнопку «ENTER LICENSE».

![](img/17/13.png)

Здесь говорится, что кнопка OK станет доступна, когда будет введена правильная комбинация.

Запустим программу в OllyDbg.

![](img/17/14.png)

Мы оказываемся в точке входа.

![](img/17/15.png)

Уфф, список используемых API-функций велик, также как и список строк.

![](img/17/16.png)

Среди этих строк нет никаких, которые подходили бы нам по смыслу, хех.

![](img/17/17.png)

Запускаем программу в OllyDbg и оказываемся в окне регистрации. Попробуем применить какой-нибудь из методов взлома данного типа защит.

![](img/17/18.png)

Вводим имя, предполагая, что оно может быть любым, поскольку узнать мы это можем только потом, затем вводим какой-нибудь редкий License Key, состоящий из 6 символов, например, WMYXSZ.

![](img/17/19.png)

Теперь нажимаем M.

![](img/17/20.png)

Поищем, нет ли в памяти строки «WM», соответствующей двум уже введённым буквам.

![](img/17/21.png)

Нажимаем клавишу M, чтобы перейти в VIEW-MEMORY, и начать поиск вышеуказанной строки.

![](img/17/22.png)

В данном случае отмечаем опцию CASE SENSITIVE, чтобы не выдавались аналоги WM в других регистрах.

![](img/17/23.png)

После двух или трёх раз, когда встретятся слова, начинающиеся с WM, и которые можно пропустить, нажав CTRL+L, и после того, как пройдём одну секцию и будем искать ниже в окне M, нам встретится WM, не входящая в состав других слов, и ещё ниже находится текст, говорящий о том, что на кнопку OK можно будет нажать после введения правильного серийного номера.

Поищем это место через DUMP.

![](img/17/24.png)

Вспомним, что адрес, который начинается с буквы (как в данном случае), должен начинаться с нуля, иначе OllyDbg его не признает.

![](img/17/25.png)

Чтобы быть уверенными, что это именно та область, где сохраняется серийный номер, введём следующую букву в поле серийного номера.

![](img/17/26.png)

![](img/17/27.png)

После этого смотрим в DUMP, символ был добавлен, а значит это и есть область, где сохраняется серийный номер, поэтому ставим сюда BREAKPOINT MEMORY ON ACCESS, охватывающий 6 цифр (так как мы знаем, что их будет ровно шесть).

![](img/17/28.png)

Теперь делаем RUN.

![](img/17/29.png)

Появляется окно, в котором вводим следующий символ – “X”.

![](img/17/30.png)

Останавливаемся на том месте, где происходит сохранение.

![](img/17/31.png)

Здесь по нажатию на F8 происходит копирование ESI в EDI.

![](img/17/32.png)

![](img/17/33.png)

Здесь происходит копирование четырёх байтов, введённых нами ранее.

![](img/17/34.png)

По нажатию на F8 они копируются в 12E79C.

![](img/17/35.png)

Так как мы уже используем BREAKPOINT MEMORY ON ACCESS, то можем установить HARDWARE BPX ON ACCESS.

![](img/17/36.png)

![](img/17/37.png)

Если оттрассируем немного, увидим моё имя также перемещается в стек.

![](img/17/38.png)

![](img/17/39.png)

Точно перед именем находится 0E, которое является его длиной, и она сравнивается с нулём.

![](img/17/40.png)

Так как не равно нулю, выполнение программы продолжается.

![](img/17/41.png)

Затем происходит сравнение имени с теми, кто находится в чёрном списке, то есть оно не должно быть TNO, afdad и т.п.

Снова делаем RUN.

![](img/17/42.png)

Останавливаемся на сравнении с серийным номером.

![](img/17/43.png)

И можем посмотреть, действительно ли это правильный серийный номер. Убираем все точки останова.

![](img/17/44.png)

После его введения становится доступной кнопка “OK”, после её нажатия мы регистрируемся, хе-хе. Другим способом, на объяснении которого я не буду задерживаться, но который не слишком сложен, является использование WM\_KEYUP каждый раз, когда нажимаем клавишу, чтобы останавливать OllyDbg и отслеживать, что происходит с введенным нами символом, но это довольно скучно, и способ, который мы применили, гораздо более простой.

Ок, давайте отдохнём немного. В следующей части мы изучим немного теории и рассмотрим несколько примеров по новой теме.

\[C\] Рикардо Нарваха, пер. Aquila
